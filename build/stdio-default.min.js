!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stdio=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name stdio
   * @author coolreader18
   */const e=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);function t(t,n,...a){const r=document.createElement(t);if("style"===t&&"object"==typeof a[0]){const t=Object.entries(a[0]);let n="";for(let a=0;a<t.length;a++){let[r,o]=t[a];Array.isArray(o)||(o=[o]),n+=(o=o.map(e=>Object.entries(e))).reduce((n,a)=>`${n}${r} {\n${a.reduce((n,[a,o])=>{if("object"==typeof o){let e=r+(a.startsWith("&")?a:" "+a);return t.push([e,o]),n}return`${n}  ${e(a)}: ${o};\n`},"")}}\n`,"")}r.textContent=n}for(let[t,a]of Object.entries(n||{})){let n=!0;"style"===t&&"object"==typeof a&&(n=!1,Object.assign(r.style,Object.entries(a).map(t=>(t[0]=e(t[0]),t)).reduce((e,[t,n])=>({...e,[t]:n}),{}))),t.match("data-.+")&&"object"==typeof a&&(a=JSON.stringify(object)),"boolean"!=typeof a||a||(n=!1),n&&r.setAttribute(t,a)}return a.forEach(e=>r.append(...[].concat(e))),r}const n=t("div");var a=Object.freeze({default:e=>({title:()=>t("h1",{class:"io-title"},e.text),textInput:()=>t("label",{class:"io-input-label"},e.label||e.name,":",t("input",{type:"text",class:"io-input"})),checkbox:()=>({elem:t("div",{class:"io-checkbox-wrapper"},e.options.map(e=>("string"==typeof e&&(e={val:e}),t("label",{class:"io-checkbox-label"},e.label||e.val,":",t("input",{type:"checkbox",class:"io-checkbox","data-value":e.val}))))),evt:"input"}),radio:()=>({elem:t("div",{class:"io-radio-wrapper"},e.options.map(n=>("string"==typeof n&&(n={val:n}),t("label",{class:"io-radio-label"},n.label||n.val,":",t("input",{type:"radio",class:"io-radio",name:e.name,"data-value":n.val}))))),evt:"input"}),output:()=>t("output",{class:"io-output"}),heading:()=>`h${e.size}`({class:"io-heading"},e.text),text:()=>t("p",{class:"io-text"},e.text),canvas:()=>({elem:t("div",{class:"io-canvas-wrapper"},t("canvas",{width:e.width||"",height:e.height||"",class:"io-canvas"})),evt:"canvas"}),file:()=>({elem:t("div",{class:"io-file-wrapper"},t("button",{class:"io-file-button"},"Choose file"),t("span",{class:"io-file-display"})),fileDragTo:null,fileDisplay:"span",fileButton:"button"}),button:()=>({elem:t("div",{class:"io-button-wrapper"},t("button",{class:"io-button"},e.label||e.name)),evt:"button"}),switch:()=>({elem:t("div",{class:"io-switch-wrapper"},t("label",{class:"io-switch-label"},e.label||e.name,t("input",{type:"checkbox",class:"io-switch"})))})})[e.type](),root:n,styleUrl:["./build/default.css","./default.css","https://cdn.jsdelivr.net/npm/stdio.js/build/default.css"]}),r=["interactive","complete"],o=function(e,t){return new Promise(function(n){e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document;var a=function(){return n(void(e&&setTimeout(e)))};-1!==r.indexOf(t.readyState)?a():t.addEventListener("DOMContentLoaded",a)})};o.resume=function(e){return function(t){return o(e).then(function(){return t})}};let s,i=({default:s}=a);const l=e=>e?Array.isArray(e)?e:[e]:[],c=(e,t)=>e.reduce((e,t)=>t(e),t),u=()=>({output:[],canvas:[]});let d=!1;const p=new class extends Array{constructor(...e){super(...e),Object.assign(this,{outputs:u(),listeners:{},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,p.update(t),!0)}),root:document.body})}refresh(){if(!d)return;const{root:e,scope:t,outputs:n,title:a,listeners:r}=p,o=document.createDocumentFragment();for(a&&o.appendChild(s({type:"title",text:a},p)),this.forEach(e=>{const{name:a}=e;let i=s(e,p);const u=l(e.transform);(i instanceof HTMLElement||Array.isArray(i))&&(i={elem:i}),i.elem=[].concat(i.elem);const d=i.elem[i.main||0],f=i.evt?d.querySelectorAll(i.evt):[d],h={textInput:()=>{let e=f[0];a&&(t[a]="",e.addEventListener("input",e=>{t[a]=c(u,e.currentTarget.value)}))},checkbox:()=>{f.forEach(e=>e.addEventListener("change",()=>{a&&(t[a]=Array.from(f).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[]))}))},radio:()=>{f.forEach(e=>e.addEventListener("change",()=>{a&&(t[a]=e.dataset.value)}))},output:()=>{n.output.push({elem:f[0],transform:e.transform})},canvas:()=>{let{interval:o,draw:s}=e;const i={type:"canvas",canvas:f[0],onUpdate:!0,handler:s};null==o&&(o="update"),"number"==typeof o&&(i.onUpdate=!1,i.interval=setInterval(handler,o)),a&&(r[a]=i,t[a]=i.canvas),n.canvas.push(i)},file:()=>{let{fileDisplay:e,fileButton:n,fileDragTo:r}=i;const o=document.createElement("input");function s(n){n&&(e.innerText=n.name,a&&(t[a]=c(u,n.slice())))}o.type="file",e=e?d.querySelector(e):d,n=n?d.querySelector(n):d,r=r?d.querySelector(r):d,n.addEventListener("click",o.click.bind(o)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&s(e.getAsFile())}else s(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>r.addEventListener(e,t)),o.addEventListener("input",e=>s(e.currentTarget.files[0]))},button:()=>{const t={type:"button",handler:e.handler};f[0].addEventListener("click",()=>this.trigger(t)),a&&(this.listeners[a]=t)},switch:()=>{f[0].addEventListener("change",({currentTarget:{checked:e}})=>{t[a]=e})}};e.type in h&&h[e.type](),i.elem.forEach(o.appendChild.bind(o))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(o)}update(e){const{output:t,canvas:n}=this.outputs;t.forEach(({elem:e,transform:t})=>{e.textContent=c(l(t).map(e=>{if("string"==typeof e){const t=e;e=(e=>e[t])}return e}),this.scope)}),n.forEach(e=>e.onUpdate&&this.trigger(e))}trigger(e){"string"==typeof e&&(e=this.listeners[e]);const{handler:t}=e;({button:()=>t(this.scope),canvas:({canvas:e})=>t(e.getContext("2d"),this.scope,e)})[e.type](e)}};return o().then(()=>{d=!0,p.root=document.body,"root"in i&&(p.root=p.root.appendChild(i.root),p.refresh()),"init"in i&&i.init(root)}),{add(...e){return p.splice(0,0,...e),p.refresh(),this},title(e){return this.dom.title=e,this},dom:new Proxy(p,{set(...e){const t=Reflect.set(...e);return t&&p.refresh(),t}}),style(e){if("function"==typeof e)s=e;else{if("object"!=typeof e)throw new Error;i=({transformElem:s}=e)}return this},loadStyleSheet(){let{styleUrl:e}=i;if(e)return"function"==typeof e&&(e=e(testing)),(e=[].concat(e)).forEach(e=>document.head.appendChild(t("link",{rel:"stylesheet",href:e}))),this}}});
