!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.easyIO=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name easyIO
   * @author coolreader18
   */const e=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);function t(t,n,...a){const o=document.createElement(t);if("style"===t&&"object"==typeof a[0]){const t=Object.entries(a[0]);let n="";for(let a=0;a<t.length;a++){let[o,r]=t[a];Array.isArray(r)||(r=[r]),n+=(r=r.map(e=>Object.entries(e))).reduce((n,a)=>`${n}${o} {\n${a.reduce((n,[a,r])=>{if("object"==typeof r){let e=o+(a.startsWith("&")?a:" "+a);return t.push([e,r]),n}return`${n}  ${e(a)}: ${r};\n`},"")}}\n`,"")}o.textContent=n}for(let[t,a]of Object.entries(n||{})){let n=!0;"style"===t&&"object"==typeof a&&(n=!1,Object.assign(o.style,Object.entries(a).map(t=>(t[0]=e(t[0]),t)).reduce((e,[t,n])=>({...e,[t]:n}),{}))),t.match("data-.+")&&"object"==typeof a&&(a=JSON.stringify(object)),n&&o.setAttribute(t,a)}return a.forEach(e=>o.append(...[].concat(e))),o}var n=e=>({title:()=>t("h1",{class:"io-title"},e.text),textInput:()=>t("label",{class:"io-input-label"},e.label||e.name,":",t("input",{type:"text",class:"io-input"})),checkbox:()=>({elem:t("div",{class:"io-checkbox-wrapper"},e.options.map(e=>("string"==typeof e&&(e={val:e}),t("label",{class:"io-checkbox-label"},e.label||e.val,":",t("input",{type:"checkbox",class:"io-checkbox","data-value":e.val}))))),evt:"input"}),radio:()=>({elem:t("div",{class:"io-radio-wrapper"},e.options.map(n=>("string"==typeof n&&(n={val:n}),t("label",{class:"io-radio-label"},n.label||n.val,":",t("input",{type:"radio",class:"io-radio",name:e.name,"data-value":n.val}))))),evt:"input"}),output:()=>t("output",{class:"io-output"}),heading:()=>t(`h${e.size||1}`,{class:"io-heading"},e.text),text:()=>t("p",{class:"io-text"},e.text),canvas:()=>({elem:t("div",{class:"io-canvas-wrapper"},t("canvas",{width:e.width||"",height:e.height||"",class:"io-canvas"})),evt:"canvas"}),file:()=>({elem:t("div",{class:"io-file-wrapper"},t("button",{class:"io-file-button"},"Choose file"),t("span",{class:"io-file-display"})),fileDragTo:null,fileDisplay:"span",fileButton:"button"})})[e.type]();const a=t("div");var o=Object.freeze({default:n,root:a}),r=["interactive","complete"],i=function(e,t){return new Promise(function(n){e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document;var a=function(){return n(void(e&&setTimeout(e)))};-1!==r.indexOf(t.readyState)?a():t.addEventListener("DOMContentLoaded",a)})};i.resume=function(e){return function(t){return i(e).then(function(){return t})}};let s=n;const l=e=>e?Array.isArray(e)?e:[e]:[],c=(e,t)=>e.reduce((e,t)=>t(e),t);let u=!1;const d=Object.assign([],{refresh(){if(!u)return;const{root:e,scope:t,outputs:n,title:a}=this,o=document.createDocumentFragment();var r,i,p;for(a&&o.appendChild(s({type:"title",text:a},d)),this.forEach(e=>{let a=s(e,d);const u=l(e.transform);(a instanceof HTMLElement||Array.isArray(a))&&(a={elem:a}),a.elem=[].concat(a.elem);const f=a.elem[a.main||0],h=a.evt?f.querySelectorAll(a.evt):[f],m={textInput:()=>{let n=h[0];t[e.name]="",n.addEventListener("input",({target:{value:n}})=>{t[e.name]=c(u,n)})},checkbox:()=>{h.forEach(n=>n.addEventListener("change",()=>t[e.name]=Array.from(h).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[])))},radio:()=>{h.forEach(n=>n.addEventListener("change",()=>t[e.name]=n.dataset.value))},output:()=>{r=n.output,i=e.link,p={elem:h[0],tranform:e.transform},r[i]?r[i].push(p):r[i]=[p]},canvas:()=>{let{interval:t}=e;const a=()=>e.process(h[0].getContext("2d"),this.scope,h[0]),o={updateCanvas:a,onUpdate:!0};void 0===t&&(t="update"),"number"==typeof t&&(o.onUpdate=!1,o.interval=setInterval(a,t)),n.canvas.push(o)},file:()=>{let{fileDisplay:n,fileButton:o,fileDragTo:r}=a;const i=document.createElement("input");function s(a){a&&(n.innerText=a.name,t[e.name]=c(u,a.slice()))}i.type="file",n=n?f.querySelector(n):f,o=o?f.querySelector(o):f,r=r?f.querySelector(r):f,o.addEventListener("click",i.click.bind(i)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&s(e.getAsFile())}else s(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>r.addEventListener(e,t)),i.addEventListener("input",e=>s(e.currentTarget.files[0]))}};e.type in m&&m[e.type](),a.elem.forEach(o.appendChild.bind(o))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(o)},update(e){const{output:t,canvas:n}=this.outputs;(t[e]||[]).forEach(({elem:t,transform:n})=>t.innerHTML=c(l(n),this.scope[e])),n.forEach(e=>{e.onUpdate&&e.updateCanvas()})},outputs:{output:{},canvas:[]},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,d.update(t),!0)}),root:document.body});return i().then(()=>{u=!0,d.root=document.body;const e="root";e in o&&(d.root=d.root.appendChild(o[e]),d.refresh());const t="init";t in o&&o[t](root)}),{add(...e){e.forEach(e=>d.push(e)),d.refresh()},title(e){return this.dom.title=e,this},dom:new Proxy(d,{set:(e,t,n)=>(e[t]=n,d.refresh(),!0)}),style(e){if("function"!=typeof e)throw new Error;s=e}}});
