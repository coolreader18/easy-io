!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stdio=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name stdio
   * @author coolreader18
   */var e=()=>{throw new Error("stdio none theme is in use and a theme hasn't been registered")},t=Object.freeze({default:e}),n=["interactive","complete"],r=function(e,t){return new Promise(function(r){e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document;var o=function(){return r(void(e&&setTimeout(e)))};-1!==n.indexOf(t.readyState)?o():t.addEventListener("DOMContentLoaded",o)})};r.resume=function(e){return function(t){return r(e).then(function(){return t})}};let o=e;const a=e=>e?Array.isArray(e)?e:[e]:[],i=(e,t)=>e.reduce((e,t)=>t(e),t);let s=!1;const d=Object.assign([],{refresh(){if(!s)return;const{root:e,scope:t,outputs:n,title:r}=this,c=document.createDocumentFragment();var u,l,f;for(r&&c.appendChild(o({type:"title",text:r},d)),this.forEach(e=>{let r=o(e,d);const s=a(e.transform);(r instanceof HTMLElement||Array.isArray(r))&&(r={elem:r}),r.elem=[].concat(r.elem);const p=r.elem[r.main||0],m=r.evt?p.querySelectorAll(r.evt):[p],h={textInput:()=>{let n=m[0];t[e.name]="",n.addEventListener("input",({target:{value:n}})=>{t[e.name]=i(s,n)})},checkbox:()=>{m.forEach(n=>n.addEventListener("change",()=>t[e.name]=Array.from(m).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[])))},radio:()=>{m.forEach(n=>n.addEventListener("change",()=>t[e.name]=n.dataset.value))},output:()=>{u=n.output,l=e.link,f={elem:m[0],tranform:e.transform},u[l]?u[l].push(f):u[l]=[f]},canvas:()=>{let{interval:t}=e;const r=()=>e.process(m[0].getContext("2d"),this.scope,m[0]),o={updateCanvas:r,onUpdate:!0};void 0===t&&(t="update"),"number"==typeof t&&(o.onUpdate=!1,o.interval=setInterval(r,t)),n.canvas.push(o)},file:()=>{let{fileDisplay:n,fileButton:o,fileDragTo:a}=r;const d=document.createElement("input");function c(r){r&&(n.innerText=r.name,t[e.name]=i(s,r.slice()))}d.type="file",n=n?p.querySelector(n):p,o=o?p.querySelector(o):p,a=a?p.querySelector(a):p,o.addEventListener("click",d.click.bind(d)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&c(e.getAsFile())}else c(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>a.addEventListener(e,t)),d.addEventListener("input",e=>c(e.currentTarget.files[0]))}};e.type in h&&h[e.type](),r.elem.forEach(c.appendChild.bind(c))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(c)},update(e){const{output:t,canvas:n}=this.outputs;(t[e]||[]).forEach(({elem:t,transform:n})=>t.innerHTML=i(a(n),this.scope[e])),n.forEach(e=>{e.onUpdate&&e.updateCanvas()})},outputs:{output:{},canvas:[]},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,d.update(t),!0)}),root:document.body});return r().then(()=>{s=!0,d.root=document.body;const e="root";e in t&&(d.root=d.root.appendChild(t[e]),d.refresh());const n="init";n in t&&t[n](root)}),{add(...e){e.forEach(e=>d.push(e)),d.refresh()},title(e){return this.dom.title=e,this},dom:new Proxy(d,{set:(e,t,n)=>(e[t]=n,d.refresh(),!0)}),style(e){if("function"!=typeof e)throw new Error;o=e}}});
