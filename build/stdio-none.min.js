!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stdio=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name stdio
   * @author coolreader18
   */var e=Object.freeze({default:()=>{throw new Error("stdio none theme is in use and a theme hasn't been registered")}}),t=["interactive","complete"],n=function(e,n){return new Promise(function(r){e&&"function"!=typeof e&&(n=e,e=null),n=n||window.document;var o=function(){return r(void(e&&setTimeout(e)))};-1!==t.indexOf(n.readyState)?o():n.addEventListener("DOMContentLoaded",o)})};n.resume=function(e){return function(t){return n(e).then(function(){return t})}};const r=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);let o,s=({default:o}=e);const a=e=>e?Array.isArray(e)?e:[e]:[],i=(e,t)=>e.reduce((e,t)=>t(e),t),c=()=>({output:[],canvas:[]});let l=!1;const d=new class extends Array{constructor(...e){super(...e),Object.assign(this,{outputs:c(),listeners:{},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,d.update(t),!0)}),root:document.body})}refresh(){if(!l)return;const{root:e,scope:t,outputs:n,title:r,listeners:s}=d,c=document.createDocumentFragment();for(r&&c.appendChild(o({type:"title",text:r},d)),this.forEach(e=>{const{name:r}=e;let l=o(e,d);const u=a(e.transform);(l instanceof HTMLElement||Array.isArray(l))&&(l={elem:l}),l.elem=[].concat(l.elem);const f=l.elem[l.main||0],p=l.evt?f.querySelectorAll(l.evt):[f],h={textInput:()=>{let e=p[0];r&&(t[r]="",e.addEventListener("input",e=>{t[r]=i(u,e.currentTarget.value)}))},checkbox:()=>{p.forEach(e=>e.addEventListener("change",()=>{r&&(t[r]=Array.from(p).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[]))}))},radio:()=>{p.forEach(e=>e.addEventListener("change",()=>{r&&(t[r]=e.dataset.value)}))},output:()=>{n.output.push({elem:p[0],transform:e.transform})},canvas:()=>{let{interval:o,draw:a}=e;const i={type:"canvas",canvas:p[0],onUpdate:!0,handler:a};null==o&&(o="update"),"number"==typeof o&&(i.onUpdate=!1,i.interval=setInterval(handler,o)),r&&(s[r]=i,t[r]=i.canvas),n.canvas.push(i)},file:()=>{let{fileDisplay:e,fileButton:n,fileDragTo:o}=l;const s=document.createElement("input");function a(n){n&&(e.innerText=n.name,r&&(t[r]=i(u,n.slice())))}s.type="file",e=e?f.querySelector(e):f,n=n?f.querySelector(n):f,o=o?f.querySelector(o):f,n.addEventListener("click",s.click.bind(s)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&a(e.getAsFile())}else a(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>o.addEventListener(e,t)),s.addEventListener("input",e=>a(e.currentTarget.files[0]))},button:()=>{const t={type:"button",handler:e.handler};p[0].addEventListener("click",()=>this.trigger(t)),r&&(this.listeners[r]=t)},switch:()=>{p[0].addEventListener("change",({currentTarget:{checked:e}})=>{t[r]=e})}};e.type in h&&h[e.type](),l.elem.forEach(c.appendChild.bind(c))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(c)}update(e){const{output:t,canvas:n}=this.outputs;t.forEach(({elem:e,transform:t})=>{e.textContent=i(a(t).map(e=>{if("string"==typeof e){const t=e;e=(e=>e[t])}return e}),this.scope)}),n.forEach(e=>e.onUpdate&&this.trigger(e))}trigger(e){"string"==typeof e&&(e=this.listeners[e]);const{handler:t}=e;({button:()=>t(this.scope),canvas:({canvas:e})=>t(e.getContext("2d"),this.scope,e)})[e.type](e)}};return n().then(()=>{l=!0,d.root=document.body,"root"in s&&(d.root=d.root.appendChild(s.root),d.refresh()),"init"in s&&s.init(root)}),{add(...e){return d.splice(0,0,...e),d.refresh(),this},title(e){return this.dom.title=e,this},dom:new Proxy(d,{set(...e){const t=Reflect.set(...e);return t&&d.refresh(),t}}),style(e){if("function"==typeof e)o=e;else{if("object"!=typeof e)throw new Error;s=({transformElem:o}=e)}return this},loadStyleSheet(){let{styleUrl:e}=s;if(e)return"function"==typeof e&&(e=e(testing)),(e=[].concat(e)).forEach(e=>document.head.appendChild(function(e,t,...n){const o=document.createElement(e);if("style"===e&&"object"==typeof n[0]){const e=Object.entries(n[0]);let t="";for(let n=0;n<e.length;n++){let[o,s]=e[n];Array.isArray(s)||(s=[s]),t+=(s=s.map(e=>Object.entries(e))).reduce((t,n)=>`${t}${o} {\n${n.reduce((t,[n,s])=>{if("object"==typeof s){let r=o+(n.startsWith("&")?n:" "+n);return e.push([r,s]),t}return`${t}  ${r(n)}: ${s};\n`},"")}}\n`,"")}o.textContent=t}for(let[e,n]of Object.entries(t||{})){let t=!0;"style"===e&&"object"==typeof n&&(t=!1,Object.assign(o.style,Object.entries(n).map(e=>(e[0]=r(e[0]),e)).reduce((e,[t,n])=>({...e,[t]:n}),{}))),e.match("data-.+")&&"object"==typeof n&&(n=JSON.stringify(object)),"boolean"!=typeof n||n||(t=!1),t&&o.setAttribute(e,n)}return n.forEach(e=>o.append(...[].concat(e))),o}("link",{rel:"stylesheet",href:e}))),this}}});
