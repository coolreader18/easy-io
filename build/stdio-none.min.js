!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stdio=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name stdio
   * @author coolreader18
   */var e=()=>{throw new Error("stdio none theme is in use and a theme hasn't been registered")},t=Object.freeze({default:e}),n=["interactive","complete"],r=function(e,t){return new Promise(function(r){e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document;var o=function(){return r(void(e&&setTimeout(e)))};-1!==n.indexOf(t.readyState)?o():t.addEventListener("DOMContentLoaded",o)})};r.resume=function(e){return function(t){return r(e).then(function(){return t})}};const o=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);let s=t,a=e,i=!1;const c=e=>e?Array.isArray(e)?e:[e]:[],l=(e,t)=>e.reduce((e,t)=>t(e),t);let d=!1;const u=Object.assign([],{refresh(){if(!d)return;const{root:e,scope:t,outputs:n,title:r,listeners:o}=this,s=document.createDocumentFragment();var i,f,p;for(r&&s.appendChild(a({type:"title",text:r},u)),this.forEach(e=>{const{name:r}=e;let d=a(e,u);const h=c(e.transform);(d instanceof HTMLElement||Array.isArray(d))&&(d={elem:d}),d.elem=[].concat(d.elem);const m=d.elem[d.main||0],y=d.evt?m.querySelectorAll(d.evt):[m],v={textInput:()=>{let e=y[0];t[r]="",e.addEventListener("input",({target:{value:e}})=>{t[r]=l(h,e)})},checkbox:()=>{y.forEach(e=>e.addEventListener("change",()=>t[r]=Array.from(y).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[])))},radio:()=>{y.forEach(e=>e.addEventListener("change",()=>t[r]=e.dataset.value))},output:()=>{i=n.output,f=e.link,p={elem:y[0],tranform:e.transform},i[f]?i[f].push(p):i[f]=[p]},canvas:()=>{let{interval:t,draw:s}=e;const a={type:"canvas",canvas:y[0],onUpdate:!0,handler:s};null==t&&(t="update"),"number"==typeof t&&(a.onUpdate=!1,a.interval=setInterval(handler,t)),n.canvas.push(o[r]=a)},file:()=>{let{fileDisplay:e,fileButton:n,fileDragTo:o}=d;const s=document.createElement("input");function a(n){n&&(e.innerText=n.name,t[r]=l(h,n.slice()))}s.type="file",e=e?m.querySelector(e):m,n=n?m.querySelector(n):m,o=o?m.querySelector(o):m,n.addEventListener("click",s.click.bind(s)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&a(e.getAsFile())}else a(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>o.addEventListener(e,t)),s.addEventListener("input",e=>a(e.currentTarget.files[0]))},button:()=>{const t={type:"button",handler:e.handler};y[0].addEventListener("click",()=>this.trigger(t)),r&&(this.listeners[r]=t)}};e.type in v&&v[e.type](),d.elem.forEach(s.appendChild.bind(s))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(s)},update(e){const{output:t,canvas:n}=this.outputs;(t[e]||[]).forEach(({elem:t,transform:n})=>t.innerHTML=l(c(n),this.scope[e])),n.forEach(e=>e.onUpdate&&this.trigger(e))},trigger(e){"string"==typeof e&&(e=this.listeners[e]);const{handler:t}=e;({button:()=>t(this.scope),canvas:({canvas:e})=>t(e.getContext("2d"),this.scope,e)})[e.type](e)},outputs:{output:{},canvas:[]},listeners:{},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,u.update(t),!0)}),root:document.body});r().then(()=>{d=!0,u.root=document.body;const e="root";e in s&&(u.root=u.root.appendChild(s[e]),u.refresh());const t="init";t in s&&s[t](root)});const f={add(...e){e.forEach(e=>u.push(e)),u.refresh()},title(e){return this.dom.title=e,this},dom:new Proxy(u,{set:(e,t,n)=>(e[t]=n,u.refresh(),!0)}),style(e){if("function"==typeof e)a=e;else{if("object"!=typeof e)throw new Error;s=e,a=e.transformElem}},loadStyleSheet(){let{styleUrl:e}=s;if(e)return"function"==typeof styleUrl&&(e=styleUrl(i)),(e=[].concat(e)).forEach(e=>document.head.appendChild(function(e,t,...n){const r=document.createElement(e);if("style"===e&&"object"==typeof n[0]){const e=Object.entries(n[0]);let t="";for(let n=0;n<e.length;n++){let[r,s]=e[n];Array.isArray(s)||(s=[s]),t+=(s=s.map(e=>Object.entries(e))).reduce((t,n)=>`${t}${r} {\n${n.reduce((t,[n,s])=>{if("object"==typeof s){let o=r+(n.startsWith("&")?n:" "+n);return e.push([o,s]),t}return`${t}  ${o(n)}: ${s};\n`},"")}}\n`,"")}r.textContent=t}for(let[e,n]of Object.entries(t||{})){let t=!0;"style"===e&&"object"==typeof n&&(t=!1,Object.assign(r.style,Object.entries(n).map(e=>(e[0]=o(e[0]),e)).reduce((e,[t,n])=>({...e,[t]:n}),{}))),e.match("data-.+")&&"object"==typeof n&&(n=JSON.stringify(object)),t&&r.setAttribute(e,n)}return n.forEach(e=>r.append(...[].concat(e))),r}("link",{rel:"stylesheet",href:e}))),this}};return Object.defineProperty(f,"testing",{value:()=>(i=!0,f),enumerable:!1}),f});
