!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stdio=t()}(this,function(){"use strict";
/* @legume @preserve
   * @name stdio
   * @author coolreader18
   */const e=e=>e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);function t(t,n,...l){const o=document.createElement(t);if("style"===t&&"object"==typeof l[0]){const t=Object.entries(l[0]);let n="";for(let l=0;l<t.length;l++){let[o,r]=t[l];Array.isArray(r)||(r=[r]),n+=(r=r.map(e=>Object.entries(e))).reduce((n,l)=>`${n}${o} {\n${l.reduce((n,[l,r])=>{if("object"==typeof r){let e=o+(l.startsWith("&")?l:" "+l);return t.push([e,r]),n}return`${n}  ${e(l)}: ${r};\n`},"")}}\n`,"")}o.textContent=n}for(let[t,l]of Object.entries(n||{})){let n=!0;"style"===t&&"object"==typeof l&&(n=!1,Object.assign(o.style,Object.entries(l).map(t=>(t[0]=e(t[0]),t)).reduce((e,[t,n])=>({...e,[t]:n}),{}))),t.match("data-.+")&&"object"==typeof l&&(l=JSON.stringify(object)),n&&o.setAttribute(t,l)}return l.forEach(e=>o.append(...[].concat(e))),o}var n=e=>({title:()=>t("div",{class:"Subhead"},t("div",{class:"Subhead-heading"},e.text)),textInput:()=>t("dl",{class:"form-group"},t("dt",null,t("label",null,e.label||e.name)),t("dd",null,t("input",{type:"text",class:"form-control",placeholder:e.placeholder||""}))),checkbox:n=>({elem:t("dl",null,t("dt",null,t("label",null,e.label||e.name)),t("dd",null,e.options.map(e=>("string"==typeof e&&(e={val:e}),t("div",{class:"form-checkbox"},t("label",null,t("input",{type:"checkbox","data-value":e.val}),e.label||e.val)))))),evt:"input"}),radio:()=>({elem:t("dl",null,t("dt",null,t("label",null,e.label||e.name)),t("dd",null,e.options.map(n=>("string"==typeof n&&(n={val:n}),t("div",{class:"form-checkbox"},t("label",{class:""},t("input",{type:"radio",name:e.name,"data-value":n.val}),n.label||n.val)))))),evt:"input"}),output:()=>({elem:t("div",{style:{display:"block",height:"fit-content",width:"fit-content",marginTop:"25px",marginBottom:"20px"}},t("output",{class:"Box p-2 hover-grow"})),evt:"output"}),heading:()=>t("h1",{class:"h"+e.size},e.text),text:()=>t("p",{class:"io-text"},e.text),canvas:()=>({elem:t("div",{class:"Box p-2",style:{width:"fit-content",height:"fit-content"}},t("canvas",{width:e.width||"",height:e.height||""})),evt:"canvas"}),file:()=>({elem:t("dl",{class:"form-group"},t("dt",null,t("label",null,e.label||e.name)),t("dd",null,t("div",{class:"form-control"},t("button",{class:"btn"},"Choose file"),t("span",{class:"m-2"})))),fileDragTo:".form-control",fileDisplay:"span",fileButton:"button"}),button:()=>({elem:t("div",{style:{padding:"10px 0"}},t("button",{class:"btn"},e.label||e.name)),evt:"button"})})[e.type]();const l=t("div",{class:"Box p-5 m-4"});var o=Object.freeze({default:n,root:l,styleUrl:"https://cdn.jsdelivr.net/npm/primer@10.4.0/build/build.css"}),r=["interactive","complete"],a=function(e,t){return new Promise(function(n){e&&"function"!=typeof e&&(t=e,e=null),t=t||window.document;var l=function(){return n(void(e&&setTimeout(e)))};-1!==r.indexOf(t.readyState)?l():t.addEventListener("DOMContentLoaded",l)})};a.resume=function(e){return function(t){return a(e).then(function(){return t})}};let s=o,i=n;const c=e=>e?Array.isArray(e)?e:[e]:[],d=(e,t)=>e.reduce((e,t)=>t(e),t);let u=!1;const p=Object.assign([],{refresh(){if(!u)return;const{root:e,scope:t,outputs:n,title:l,listeners:o}=p,r=document.createDocumentFragment();var a,s,f;for(l&&r.appendChild(i({type:"title",text:l},p)),this.forEach(e=>{const{name:l}=e;let u=i(e,p);const h=c(e.transform);(u instanceof HTMLElement||Array.isArray(u))&&(u={elem:u}),u.elem=[].concat(u.elem);const m=u.elem[u.main||0],v=u.evt?m.querySelectorAll(u.evt):[m],y={textInput:()=>{let e=v[0];l&&(t[l]="",e.addEventListener("input",({target:{value:e}})=>{t[l]=d(h,e)}))},checkbox:()=>{v.forEach(e=>e.addEventListener("change",()=>{l&&(t[l]=Array.from(v).reduce((e,t)=>e.concat(t.checked?t.dataset.value:[]),[]))}))},radio:()=>{v.forEach(e=>e.addEventListener("change",()=>{l&&(t[l]=e.dataset.value)}))},output:()=>{a=n.output,s=e.link,f={elem:v[0],tranform:e.transform},a[s]?a[s].push(f):a[s]=[f]},canvas:()=>{let{interval:r,draw:a}=e;const s={type:"canvas",canvas:v[0],onUpdate:!0,handler:a};null==r&&(r="update"),"number"==typeof r&&(s.onUpdate=!1,s.interval=setInterval(handler,r)),l&&(o[l]=t[l]=s),n.canvas.push(s)},file:()=>{let{fileDisplay:e,fileButton:n,fileDragTo:o}=u;const r=document.createElement("input");function a(n){n&&(e.innerText=n.name,l&&(t[l]=d(h,n.slice())))}r.type="file",e=e?m.querySelector(e):m,n=n?m.querySelector(n):m,o=o?m.querySelector(o):m,n.addEventListener("click",r.click.bind(r)),Object.entries({drop:e=>{e.preventDefault();var t=e.dataTransfer;if(t.items){const e=t.items[0];"file"==e.kind&&a(e.getAsFile())}else a(t.files[0])},dragover:e=>e.preventDefault(),dragend:e=>{var t=e.dataTransfer;if(t.items)for(var n=0;n<t.items.length;n++)t.items.remove(n);else e.dataTransfer.clearData()}}).forEach(([e,t])=>o.addEventListener(e,t)),r.addEventListener("input",e=>a(e.currentTarget.files[0]))},button:()=>{const t={type:"button",handler:e.handler};v[0].addEventListener("click",()=>this.trigger(t)),l&&(this.listeners[l]=t)}};e.type in y&&y[e.type](),u.elem.forEach(r.appendChild.bind(r))});e.firstChild;)e.removeChild(e.firstChild);this.root.appendChild(r)},update(e){const{output:t,canvas:n}=this.outputs;(t[e]||[]).forEach(({elem:t,transform:n})=>t.innerHTML=d(c(n),this.scope[e])),n.forEach(e=>e.onUpdate&&this.trigger(e))},trigger(e){"string"==typeof e&&(e=this.listeners[e]);const{handler:t}=e;({button:()=>t(this.scope),canvas:({canvas:e})=>t(e.getContext("2d"),this.scope,e)})[e.type](e)},outputs:{output:{},canvas:[]},listeners:{},scope:new Proxy({},{set:(e,t,n)=>(e[t]=n,p.update(t),!0)}),root:document.body});return a().then(()=>{u=!0,p.root=document.body;const e="root";e in s&&(p.root=p.root.appendChild(s[e]),p.refresh());const t="init";t in s&&s[t](root)}),{add(...e){e.forEach(e=>p.push(e)),p.refresh()},title(e){return this.dom.title=e,this},dom:new Proxy(p,{set:(e,t,n)=>(e[t]=n,p.refresh(),!0)}),style(e){if("function"==typeof e)i=e;else{if("object"!=typeof e)throw new Error;s=e,i=e.transformElem}},loadStyleSheet(){let{styleUrl:e}=s;if(e)return"function"==typeof e&&(e=e(testing)),(e=[].concat(e)).forEach(e=>document.head.appendChild(t("link",{rel:"stylesheet",href:e}))),this}}});
